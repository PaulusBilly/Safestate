<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safestate - My Properties</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/searchbar.css">
    <link rel="stylesheet" href="css/properties.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="navigation">
        <div class="navBar">
          <div class="nav-left">
            <a href="marketplace.html">Marketplace</a>
            <a href="#" class="active">Properties</a>
          </div>
        
          <div class="nav-logo">
            <a href="index.html" class="logo">SAFESTATE</a>
          </div>
        
          <div class="nav-right">
            <a href="faq.html">FAQ</a>
            <div class="cta">
              <a href="account.html">Account</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Page Header -->
    <div class="page-header">
      <div class="page-header-content">
        <h1>My Properties</h1>
        <p class="page-subtitle">Manage and view all your owned and rented properties</p>
        <div class="property-stats">
          <div class="stat-item">
            <span class="stat-number" id="ownedCount">0</span>
            <span class="stat-label">Owned</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="rentedCount">0</span>
            <span class="stat-label">Rented</span>
          </div>
        </div>
      </div>
    </div>

    <div class="search-wrapper">
      <div class="icon-wrapper filter-icon">
        <i class="fa fa-filter toggle-filter"></i>
      </div>
      <input type="text" placeholder="Search your properties by name, location, or type" />
      <div class="icon-wrapper search-icon">
        <i class="fa fa-search"></i>
      </div>
      <hr style="width:1.2px; height:30px; background-color:rgb(166, 166, 166); border:none; margin:0 0.4rem;">
      <a href="favorites.html" class="icon-wrapper cart-icon">
        <i class="fas fa-heart"></i>
        <span class="cart-badge" id="favoriteCount">3</span>
      </a>
    </div>

    <div class="property-card" style="display: none;">
      <!-- This is a template card that will be hidden and replaced with dynamically loaded cards -->
      <div class="property-image">
        <div class="property-meta">
          <span><i class="fa-solid fa-bed"></i> 3</span>
          <span><i class="fa-solid fa-toilet"></i> 2</span> 
        </div>
      </div>
      <div class="property-details">
        <small class="status">RENTED</small>
        <h3 class="name">Property Name</h3>
        <p class="location">Location</p>
        <p class="contract">Contract ends in: 13 Days</p>
        <p class="price">Rp1.400.000/month</p>
      </div>
      <div class="property-action">
        <a href="propertiesdetails.html"><button class="details-btn">Details</button></a>
      </div>
    </div>
    
    <div id="properties-container" class="properties-grid">
      <!-- Property cards will be dynamically loaded here -->
    </div>
    
    <div class="filter-panel">
        Browse more properties
        
        <select id="marketplacePrice">
          <option disabled selected>Price</option>
          <option value="low">Lowest</option>
          <option value="high">Highest</option>
        </select>
        
        <select id="marketplaceSize">
          <option disabled selected>Size</option>
          <option value="smallest">Smallest</option>
          <option value="largest">Largest</option>
        </select>
        
        <select id="marketplaceType">
          <option disabled selected>Type</option>
          <option value="apartment">Apartment</option>
          <option value="house">House</option>
          <option value="land">Land</option>
        </select>
        
        <select id="marketplaceRentBuy">
          <option disabled selected>Rent/Buy</option>
          <option value="rent">Rent</option>
          <option value="buy">Buy</option>
        </select>
        
        <hr style="width:1.2px; height:30px; background-color:rgb(166, 166, 166); border:none; margin:0 0.4rem;">
        
        <button class="apply-filter" onclick="redirectToMarketplace()">Browse Marketplace</button>
        </div>

<!-- Property Detail Overlay -->
<div class="overlay" id="propertyOverlay">
  <div class="overlay-content">
    <button class="close-overlay" onclick="closeOverlay()"><i class="fas fa-times"></i></button>
    <div class="overlay-body">
      <div class="overlay-left">
        <img src="https://via.placeholder.com/400x300" alt="Property Image" class="main-image" />
        <div class="image-thumbnails">
          <img src="https://via.placeholder.com/100" alt="Thumbnail" />
          <img src="https://via.placeholder.com/100" alt="Thumbnail" />
          <img src="https://via.placeholder.com/100" alt="Thumbnail" />
        </div>
      </div>
      <div class="overlay-right">
        <small class="label">Label</small>
        <h2 class="property-title">Property Name</h2>
        <p class="published-date">Published on</p>
        <p class="location">Location</p>
        <p class="description">Short description</p>
        <p class="price"><strong>Rp 2.500.000.000</strong></p>
        <div class="agent-contact">
          <div class="agent-info">
            <img src="agent-photo.jpg" alt="Agent" class="agent-photo" />
            <div class="agent-details">
              <strong>Paulus Billiardo Putrakedua</strong>
              <small>Billiardo Enterprise</small>
            </div>
          </div>
          <a href="https://wa.me/6281807216060" target="_blank" class="whatsapp-btn">
            Direct to WhatsApp
          </a>
        </div>
        <div class="secondary-cta">
          <button class="cta-btn add-to-favorites">
            <i class="fas fa-heart"></i>Add to Favorites
          </button>
          <button class="cta-btn buy-now">
            Buy Now
          </button>
        </div>
      </div>
    </div>
    <hr>
    <div class="property-details-tables">
      <h3>Specification</h3>
      <table>
        <tr><th>Luas Tanah</th><td>120 m²</td><th>Sertifikat</th><td>SHM</td></tr>
        <tr><th>Luas Bangunan</th><td>90 m²</td><th>Daya Listrik</th><td>2200 Watt</td></tr>
        <tr><th>Tipe Properti</th><td>Rumah</td><th>Jumlah Lantai</th><td>2</td></tr>
        <tr><th>Bedrooms</th><td>3</td><th>Bathrooms</th><td>2</td></tr>
      </table>

      <h3>Facility</h3>
      <table>
        <tr><th>Swimming Pool</th><td>Yes</td><th>Gym</th><td>No</td></tr>
        <tr><th>Security 24/7</th><td>Yes</td><th>Playground</th><td>Yes</td></tr>
        <tr><th>Parking Space</th><td>Yes</td><th>Internet</th><td>Yes</td></tr>
      </table>

      <h3>Nearby Attraction</h3>
      <table>
        <tr><th>Shopping Mall</th><td>5 mins drive</td><th>City Park</th><td>10 mins walk</td></tr>
        <tr><th>Hospital</th><td>8 mins drive</td><th>School</th><td>4 mins walk</td></tr>
        <tr><th>Train Station</th><td>15 mins drive</td><th>Supermarket</th><td>2 mins walk</td></tr>
      </table>
    </div>
  </div>
</div>

</body>
<script src="js/auth.js"></script>
<script src="js/navbar.js"></script>
<script src="js/searchbar.js"></script>
<script src="js/data.js"></script>
<script src="js/auth.js"></script>
<script src="js/favorites.js"></script>
<script src="js/user-properties.js"></script>
<script src="js/property-display.js"></script>
<script>
  // Initialize components
  document.addEventListener('DOMContentLoaded', async () => {
    // Update favorites count
    await updateFavoritesCount();
    
    // Fix cart link to point to favorites.html
    const cartLinks = document.querySelectorAll('.cart-icon');
    cartLinks.forEach(cartLink => {
      if (cartLink) {
        cartLink.href = 'favorites.html';
      }
    });
    
    // Get current user
    const currentUser = getCurrentUser();
    if (!currentUser) {
      // Redirect to login if not logged in
      window.location.href = 'account.html';
      return;
    }
    
    // Initialize user property arrays if they don't exist
    if (!currentUser.ownedProperties) {
      currentUser.ownedProperties = ["prop-001", "prop-004"]; // For demo purposes
      await updateUserProfile(currentUser.id, { ownedProperties: currentUser.ownedProperties });
    }
    
    if (!currentUser.boughtProperties) {
      currentUser.boughtProperties = ["prop-006", "prop-020"]; // For demo purposes
      await updateUserProfile(currentUser.id, { boughtProperties: currentUser.boughtProperties });
    }
    
    if (!currentUser.rentedProperties) {
      currentUser.rentedProperties = ["prop-024"]; // For demo purposes
      await updateUserProfile(currentUser.id, { rentedProperties: currentUser.rentedProperties });
    }
    
    // Add search functionality for user properties
    const searchInput = document.querySelector('.search-wrapper input');
    if (searchInput) {
      searchInput.addEventListener('input', debounce(async () => {
        const filterOptions = {
          search: searchInput.value.trim()
        };
        await displayUserProperties('properties-container', filterOptions);
      }, 300));
    }
    
    // Add filter functionality to redirect to marketplace
    const applyFilterBtn = document.querySelector('.apply-filter');
    if (applyFilterBtn) {
      applyFilterBtn.removeEventListener('click', () => {}); // Remove existing listener
    }
    
    // Display user properties
    await displayUserProperties('properties-container');
  });
  
  // Debounce function to limit how often the search handler runs
  function debounce(func, wait) {
    let timeout;
    return function() {
      const context = this;
      const args = arguments;
      clearTimeout(timeout);
      timeout = setTimeout(() => {
        func.apply(context, args);
      }, wait);
    };
  }

  // Redirect to marketplace with filters
  function redirectToMarketplace() {
    const price = document.getElementById('marketplacePrice').value;
    const size = document.getElementById('marketplaceSize').value;
    const type = document.getElementById('marketplaceType').value;
    const rentBuy = document.getElementById('marketplaceRentBuy').value;
    
    let url = 'marketplace.html?';
    const params = [];
    
    if (price && price !== 'disabled') params.push(`price=${price}`);
    if (size && size !== 'disabled') params.push(`size=${size}`);
    if (type && type !== 'disabled') params.push(`type=${type}`);
    if (rentBuy && rentBuy !== 'disabled') params.push(`rentbuy=${rentBuy}`);
    
    url += params.join('&');
    window.location.href = url;
  }
</script>
</html>